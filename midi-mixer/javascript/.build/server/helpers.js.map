{"version":3,"names":["fs","dBtoRaw","dB","transfertTable","nearestdB","reduce","a","b","Math","abs","index","findIndex","e","length","rawtodB","raw","parseInt","round","rawtoLin","range","sens","amplitude","lin","linToRaw","rawToUser","currentValues","faderType","faderRange","Error","userToRaw","getFaderRange","config","type","min","parseFloat","max","normRange","parseTrackConfig","channel","disabled","name"],"sources":["../../src/server/helpers.js"],"sourcesContent":["import fs from 'fs';\n\nfunction dBtoRaw(dB, transfertTable) {\n  const nearestdB = transfertTable.reduce((a, b) => {\n    return Math.abs(b - dB) < Math.abs(a - dB) ? b : a;\n  });\n  const index = transfertTable.findIndex(e => e === nearestdB);\n  return (index / transfertTable.length);\n}\n\nfunction rawtodB(raw, transfertTable) {\n  const index = parseInt(raw * (transfertTable.length - 1));\n  const dB = Math.round(transfertTable[index] * 100) / 100;\n  return dB;\n}\n\nfunction rawtoLin(raw, range) {\n  const sens = (range[1] > range[0]) ? 1 : -1;\n  const amplitude = Math.abs(range[1] - range[0]);\n  const lin = range[0] + sens * (raw * amplitude);\n  return (Math.round(lin * 100) / 100);\n}\n\nfunction linToRaw(lin, range) {\n  const sens = (range[1] > range[0]) ? 1 : -1;\n  const amplitude = Math.abs(range[1] - range[0]);\n  const raw = sens * (lin - range[0]) / amplitude;\n  return raw;\n}\n\nexport function rawToUser(raw, transfertTable, currentValues) {\n  // currentValues.faderType is volume or linear - possibly expand to exponential, polynomial, logarithmic\n  switch (currentValues.faderType) {\n  case 'volume':\n    return rawtodB(raw, transfertTable);\n    break;\n  case 'linear':\n    return rawtoLin(raw, currentValues.faderRange[0]);\n    break;\n  default:\n    throw new Error(`${currentValues.faderType} is not defined`);\n  }\n}\n\nexport function userToRaw(raw, transfertTable, currentValues) {\n  // currentValues.faderType is volume or linear - possibly expand to exponential, polynomial, logarithmic\n  switch (currentValues.faderType) {\n  case 'volume':\n    return dBtoRaw(raw, transfertTable);\n    break;\n  case 'linear':\n    return linToRaw(raw, currentValues.faderRange[0]);\n    break;\n  default:\n    throw new Error(`${currentValues.faderType} is not defined`);\n  }\n}\n\n// return range and normalized range (dans le bon sens..).\nexport function getFaderRange(config) {\n  if (config.range && config.range.length === 2 && config.type !== 'volume') {\n    const min = parseFloat(config.range[0]);\n    const max = parseFloat(config.range[1]);\n    const normRange = (max > min ? [min, max] : [max, min]);\n    return [[min, max],normRange];\n  } else if (config.type !== 'volume') {\n    return [[0, 1], [0, 1]];\n  } else if (config.type === 'volume') {\n    return [[-144.5, 12], [-144.5, 12]];\n  } else {\n    throw new Error(\"Can't parse fader range\");\n  }\n}\n\n\nexport function parseTrackConfig(config) {\n  const range = getFaderRange(config);\n\n  return {\n    channel: config.channel,\n    disabled: false,\n    name: config.name,\n    faderType: config.type,\n    faderRange: range,\n  };\n}\n"],"mappings":"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"}
