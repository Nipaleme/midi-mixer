{"version":3,"names":["Server","onFaderMove","name","state","chName","index","indexOf","console","log","absFaderNumber","page","relFaderNumber","tracks","stateManager","getCollection","midiConfig","undefined","stuff","XT","setFader","type","range","sens","raw","device","fader","length","amplitude","Math","abs","value","patch","update","globals","set","source","setFaderRelease"],"sources":["../../src/server/onFaderMove.js"],"sourcesContent":["import { Server } from '@soundworks/core/server.js';\n\nexport function onFaderMove( name, state ) {\n  const chName = ['CH1','CH2','CH3','CH4','CH5','CH6','CH7','CH8'];\n\n  const index = chName.indexOf(name);\n  console.log(name, state);\n  const absFaderNumber = (index !== -1) ? (index + 1 + page * 8) : 'MAIN';\n  const relFaderNumber = (index !== -1) ? (index + 1) : null;\n  const tracks = Server.stateManager.getCollection('track');\n  console.log('tracks________', tracks);\n\n  if (midiConfig[absFaderNumber] !== undefined) {\n    console.log('> send back value to fader', stuff++);\n    // XT.setFaderRelease(`CH${relFaderNumber}`, true);\n    XT.setFader(`CH${relFaderNumber}`, state);\n\n    if (midiConfig[absFaderNumber].type === \"linear\") {\n      const range = midiConfig[absFaderNumber].range;\n      const sens = (range[1] > range[0]) ? 1 : -1;\n      const raw = state / (device.fader.length - 1);\n      const amplitude = Math.abs(range[1] - range[0]);\n      const value = range[0] + sens * (raw * amplitude);\n      if (typeof state === 'number') {\n        midiConfig[absFaderNumber].value = value;\n      }\n    } else if (midiConfig[absFaderNumber].type === \"volume\") {\n      const value = device.fader[state];\n      if (typeof state === 'number') {\n        midiConfig[absFaderNumber].value = value;\n      }\n    }\n    const value = midiConfig[absFaderNumber].value;\n    const patch = midiConfig[absFaderNumber].patch;\n    let update = {};\n    update[patch] = value;\n\n    globals.set(update, { source: 'midi' });\n  } else {\n    XT.setFaderRelease(`CH${relFaderNumber}`, false);\n    XT.setFader(`CH${relFaderNumber}`, 0);\n  }\n\n}\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,4BAA4B;AAEnD,OAAO,SAASC,WAAWA,CAAEC,IAAI,EAAEC,KAAK,EAAG;EACzC,MAAMC,MAAM,GAAG,CAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,CAAC;EAEhE,MAAMC,KAAK,GAAGD,MAAM,CAACE,OAAO,CAACJ,IAAI,CAAC;EAClCK,OAAO,CAACC,GAAG,CAACN,IAAI,EAAEC,KAAK,CAAC;EACxB,MAAMM,cAAc,GAAIJ,KAAK,KAAK,CAAC,CAAC,GAAKA,KAAK,GAAG,CAAC,GAAGK,IAAI,GAAG,CAAC,GAAI,MAAM;EACvE,MAAMC,cAAc,GAAIN,KAAK,KAAK,CAAC,CAAC,GAAKA,KAAK,GAAG,CAAC,GAAI,IAAI;EAC1D,MAAMO,MAAM,GAAGZ,MAAM,CAACa,YAAY,CAACC,aAAa,CAAC,OAAO,CAAC;EACzDP,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEI,MAAM,CAAC;EAErC,IAAIG,UAAU,CAACN,cAAc,CAAC,KAAKO,SAAS,EAAE;IAC5CT,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAES,KAAK,EAAE,CAAC;IAClD;IACAC,EAAE,CAACC,QAAQ,CAAE,KAAIR,cAAe,EAAC,EAAER,KAAK,CAAC;IAEzC,IAAIY,UAAU,CAACN,cAAc,CAAC,CAACW,IAAI,KAAK,QAAQ,EAAE;MAChD,MAAMC,KAAK,GAAGN,UAAU,CAACN,cAAc,CAAC,CAACY,KAAK;MAC9C,MAAMC,IAAI,GAAID,KAAK,CAAC,CAAC,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC,GAAI,CAAC,GAAG,CAAC,CAAC;MAC3C,MAAME,GAAG,GAAGpB,KAAK,IAAIqB,MAAM,CAACC,KAAK,CAACC,MAAM,GAAG,CAAC,CAAC;MAC7C,MAAMC,SAAS,GAAGC,IAAI,CAACC,GAAG,CAACR,KAAK,CAAC,CAAC,CAAC,GAAGA,KAAK,CAAC,CAAC,CAAC,CAAC;MAC/C,MAAMS,KAAK,GAAGT,KAAK,CAAC,CAAC,CAAC,GAAGC,IAAI,IAAIC,GAAG,GAAGI,SAAS,CAAC;MACjD,IAAI,OAAOxB,KAAK,KAAK,QAAQ,EAAE;QAC7BY,UAAU,CAACN,cAAc,CAAC,CAACqB,KAAK,GAAGA,KAAK;MAC1C;IACF,CAAC,MAAM,IAAIf,UAAU,CAACN,cAAc,CAAC,CAACW,IAAI,KAAK,QAAQ,EAAE;MACvD,MAAMU,KAAK,GAAGN,MAAM,CAACC,KAAK,CAACtB,KAAK,CAAC;MACjC,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;QAC7BY,UAAU,CAACN,cAAc,CAAC,CAACqB,KAAK,GAAGA,KAAK;MAC1C;IACF;IACA,MAAMA,KAAK,GAAGf,UAAU,CAACN,cAAc,CAAC,CAACqB,KAAK;IAC9C,MAAMC,KAAK,GAAGhB,UAAU,CAACN,cAAc,CAAC,CAACsB,KAAK;IAC9C,IAAIC,MAAM,GAAG,CAAC,CAAC;IACfA,MAAM,CAACD,KAAK,CAAC,GAAGD,KAAK;IAErBG,OAAO,CAACC,GAAG,CAACF,MAAM,EAAE;MAAEG,MAAM,EAAE;IAAO,CAAC,CAAC;EACzC,CAAC,MAAM;IACLjB,EAAE,CAACkB,eAAe,CAAE,KAAIzB,cAAe,EAAC,EAAE,KAAK,CAAC;IAChDO,EAAE,CAACC,QAAQ,CAAE,KAAIR,cAAe,EAAC,EAAE,CAAC,CAAC;EACvC;AAEF"}
